services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: quiz-game-local
    # Note: We don't set user here because the entrypoint script runs as root
    # to fix volume permissions, then drops privileges to nextjs (uid 1001)
    ports:
      - '3000:3000'
    volumes:
      - quiz_data_local:/app/data
    environment:
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      - PORT=3000
      - HOSTNAME=0.0.0.0
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'node', '-e', "require('http').get('http://localhost:3000/api/health', (res) => res.statusCode === 200 ? process.exit(0) : process.exit(1)).on('error', () => process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

volumes:
  quiz_data_local:
